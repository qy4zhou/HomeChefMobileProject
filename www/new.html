<!Doctype html>
<html ng-app = "homeChef">
    <head>
        <meta charset="utf-8" />
        <title>Home Chef</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
        <meta name="apple-mobile-web-app-status-bar-style" content="yes" />
        <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
        <link rel="stylesheet" href="css/mobile-angular-ui-hover.min.css" />
        <link rel="stylesheet" href="css/mobile-angular-ui-base.min.css" />
        <link rel="stylesheet" href="css/mobile-angular-ui-desktop.min.css" />
        <link rel="stylesheet" href="css/bootstrap.css" />
        <link rel="stylesheet" href="css/main.css" />
        <script src='cordova.js'></script>
        <script src="js/angular.min.js"></script>
        <script src="js/angular-route.min.js"></script>
        <script src="js/mobile-angular-ui.min.js"></script>
        <!-- Required to use $swipe, $drag and Translate services -->
        <script src="js/mobile-angular-ui.gestures.min.js"></script>
        <script src='js/lodash.min.js'></script>
        <script src="js/index.js"></script>
    </head>

    <body>
        <div class="scrollable">
            <div class="scrollable-content  section backgroundColor">
                <!--
<div ng-controller = "formController">
<table>
<tr ng-repeat = "entry in collection">
<td>
{{entry.title}} <br>
{{entry.content}}<br>
{{entry.notes}}<br>
</td>
</tr>
</table>

<form class="formNew" ng-submit="addEntry()">
<h3>Recipe Name</h3>
<textarea rows = "1" cols="50" ng-model = "newData.title" required></textarea><br>
<h3>Ingredients</h3>
<textarea rows = "6" cols="50" ng-model = "newData.content" required></textarea>
<br><br>
<h3>Notes (tips for next time?)</h3>
<textarea rows = "3" cols="50" ng-model = "newData.notes" required></textarea>
<br><br><br>
<div row = "col-xs-6">
<div class = "pull-right">
<input class="linkButton1" type = "submit" value = "">
</div>
<div class = "pull-left">
<a href = "/index.html"><input class="linkButton2" type="button" value = ""></a>
</div>
</div>
</form>

</div>
-->
                <img class="centered" id="button2" src = "images/button2-createNew.gif">
                <br><br>
                <div class="containerEdit">
                    <form onsubmit="return saveText()">
                        <label for="name"><h4>Recipe Name</h4></label><br>
                        <textarea rows = "1" cols="30" id="name"></textarea><br>
                        <label for="content"><h4>Ingredients/Instructions</h4></label><br>
                        <textarea rows = "6" cols="40" id="content"></textarea><br>
                        <label for="notes"><h4>Notes</h4></label><br>
                        <textarea rows = "3" cols="40" id="notes"></textarea><br>
                        <br><br>
                        <div row = "col-xs-6">
                            <div class = "pull-left">
                                <input class="linkButton1" type="submit" value = "" onclick="alertFunction()">
                            </div>
                            <div class = "pull-right">
                                <a href = "index.html"><input class="linkButton2" type="button" value = ""></a>
                            </div>
                        </div>
                        </div>
                    <dl id="definitions"></dl>
                </div>
                </form>
        </div>

        <script>
            function alertFunction(){
                alert("Saved");
                window.location.replace("/index.html");
            };

            var FILENAME = 'database.db',
                $ = function (id) {
                    return document.getElementById(id);
                },
                failCB = function (msg) {
                    return function () {
                        alert('[FAIL] ' + msg);
                    }
                },
                file = {
                    writer: { available: false },
                    reader: { available: false }
                },
                dbEntries = [];
            document.addEventListener('deviceready', function () {
                var fail = failCB('requestFileSystem');
                window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
            }, false);
            function gotFS(fs) {
                var fail = failCB('getFile');
                fs.root.getFile(FILENAME, {create: true, exclusive: false},
                                gotFileEntry, fail);
            }
            function gotFileEntry(fileEntry) {
                var fail = failCB('createWriter');
                file.entry = fileEntry;
                fileEntry.createWriter(gotFileWriter, fail);
                readText();
            }
            function gotFileWriter(fileWriter) {
                file.writer.available = true;
                file.writer.object = fileWriter;
            }
            function saveText(e) {
                var name = $('name').value,
                    content = $('content').value,
                    notes = $('notes').value,
                    fail;
//                dbEntries.push('<dt>' + name + '</dt><dd>' + content + '</dd>' + '<dd>' + notes + '</dd>')
                $('name').value = '';
                $('content').value = '';
                $('notes').value = '';
                $('definitions').innerHTML = dbEntries.join('');
                if (file.writer.available) {
                    file.writer.available = false;
                    file.writer.object.onwriteend = function (evt) {
                        file.writer.available = true;
                        file.writer.object.seek(0);
                    }
                    file.writer.object.write(dbEntries.join("\n"));
                }
                return false;
            }
            function readText() {
                if (file.entry) {
                    file.entry.file(function (dbFile) {
                        var reader = new FileReader();
                        reader.onloadend = function (evt) {
                            var textArray = evt.target.result.split("\n");
                            dbEntries = textArray.concat(dbEntries);
                            $('definitions').innerHTML = dbEntries.join('');
                        }
                        reader.readAsText(dbFile);
                    }, failCB("FileReader"));
                }
                return false;
            }
        </script>

    </body>
</html>
